---
title: "preprocessing"
output: pdf_document
date: "2022-10-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results='hide', message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.height = 4, fig.width = 6)
options(knitr.kable.NA = '',knitr.table.format = "latex")
knitr::read_chunk('../r-imports/init.R')
library(kableExtra)
```

```{r init-setup}
```


---
# ##################################################
# Run this when not knitting (and none of the above)
---

```{r, eval = FALSE}
source('r-imports/init.R')
```

---
# Any collab code below this line :)
# ##################################################
---





```{r}
data_gwp100 = read_excel("data-raw/essd_ghg_data_gwp100.xlsx",sheet = "data")
load("data-raw/data_wdi.RData") 
data_wdi %<>%
  select(-country)

data_base = data_gwp100 %>%
  left_join(data_wdi,by=c("ISO","year")) %>%
  mutate(GHG_pc = GHG/pop) %>%
  mutate(GDP_pc = gdp_ppp/pop) %>%
  filter(year <= 2019) %>% 
  mutate(EU= case_when(country %cin% eurostat::eu_countries[2]~ "Yes"))





save(data_base,file="data-transf/data_base.RData")
```


```{r}
load("data-raw/data_iea.RData")


data_kaya = data_base %>% 
  group_by(ISO,country,year,GDP_pc) %>% 
  summarise(CO2=sum(CO2,na.rm=TRUE)) %>%
  left_join(data_iea,data_iea,by=c("ISO","year")) %>%
  mutate(energy_intensity = energy/GDP_pc) %>%
  mutate(carbon_intensity = CO2/energy) %>%
  na.omit()

save(data_base,file="data-transf/data_kaya.RData")
```


```{r}

```